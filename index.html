<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>バトルアリーナ - 勇者の試練</title>
    <style>
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'MS Gothic', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
            padding: 10px;
        }
        #game-container {
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid #0f0;
            padding: 10px;
        }
        #game-output {
            height: 400px;
            overflow-y: scroll;
            border: 1px solid #0f0;
            padding: 10px;
            margin-bottom: 10px;
        }
        #game-input {
            width: 100%;
            background-color: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 5px;
            font-family: 'MS Gothic', 'Courier New', monospace;
        }
        #status-display {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 5px;
            border: 1px solid #0f0;
        }
        .status {
            width: 48%;
        }
        .enemy-appear {
            color: #f00;
        }
        .player-action {
            color: #0ff;
        }
        .item-use {
            color: #ff0;
        }
        .level-up {
            color: #f0f;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-output"></div>
        <input type="text" id="game-input" placeholder="コマンドを入力してください...">
        <div id="status-display">
            <div id="player-status" class="status"></div>
            <div id="enemy-status" class="status"></div>
        </div>
    </div>
    <script>
        /*主要な変数と関数：
        player: プレイヤーのステータスを保持するオブジェクト
        currentEnemy: 現在戦闘中の敵のステータスを保持するオブジェクト
        classes: プレイヤーの職業ごとの初期ステータスを定義するオブジェクト
        enemies: 敵の種類ごとの初期ステータスを定義するオブジェクト
        items: アイテムの効果を定義するオブジェクト
        startBattle(): 戦闘を開始する関数
        performAction(action): プレイヤーの行動を実行する関数
        useSkill(skillIndex): プレイヤーのスキルを使用する関数
        enemyTurn(): 敵の行動を実行する関数
        updateStatus(): プレイヤーと敵のステータス表示を更新する関数*/

        // 技の攻撃力やHPの変更方法：
        /*技の攻撃力を変更するには、useSkill関数内で各スキルのダメージ計算を調整
        　例えば：*/
        /*
        case '剣撃':

            damage = Math.max(1, player.attack * 1.5 - currentEnemy.defense);

            break;

        */
        // この例では、1.5の部分を変更することで攻撃力を調整できる。

        /*敵のHPを変更するには、enemiesオブジェクト内の該当する敵のhpプロパティを変更：*/
        /*
        enemies: {

            slime: { name: 'スライム', hp: 30, mp: 0, attack: 5, defense: 3, speed: 5, skills: ['たいあたり', '様子をうかがう'] },

        }  
        */
        // その他
        /*プレイヤーのステータスを変更する場合は、classesオブジェクト内の該当する職業のプロパティを変更。

        アイテムの効果を変更する場合は、itemsオブジェクト内の該当するアイテムのプロパティを変更。

        敵のスキルの効果を変更する場合は、enemyTurn関数内の該当するスキルのケースを探して、ダメージ計算や効果の処理を調整。*/

        // 新しい敵を追加するには：
        // `enemies` オブジェクトに新しい敵の定義を追加。

        // 新しい魔法やスキルを追加するには：
        // `classes` オブジェクト内の該当する職業の `skills` 配列に新しいスキル名を追加し、`useSkill` 関数内に新しいスキルの効果を実装。

        // 新しいプレイヤーの役職を追加するには：

        // `classes` オブジェクトに新しい職業の定義を追加し、
        // `createCharacter` 関数内で新しい職業を選択できるようにする。

        // 新しいアイテムを追加するには：
        // `items` オブジェクトに新しいアイテムの定義を追加し、`useItem` 関数内に新しいアイテムの効果を実装。




        const output = document.getElementById('game-output');
        const input = document.getElementById('game-input');
        const playerStatusDisplay = document.getElementById('player-status');
        const enemyStatusDisplay = document.getElementById('enemy-status');

        let gameState = 'title';
        let player = null;
        let currentEnemy = null;

        //プレイヤーの初期ステータスと技
        const classes = {
            warrior: { name: '戦士', hp: 9000, mp: 50, attack: 30, defense: 10, speed: 8, skills: ['剣撃', '盾防御', '突進'] },
            mage: { name: '魔法使い', hp: 80, mp: 100, attack: 8, defense: 5, speed: 10, skills: ['ファイアボール', 'ヒール', 'マナシールド'] },
            thief: { name: '盗賊', hp: 90, mp: 70, attack: 12, defense: 7, speed: 15, skills: ['急所突き', '毒霧', '回避'] }
        };

        //敵のステータスと技を設定
        const enemies = {
            // Cランク
            slime: { name: 'スライム', hp: 30, mp: 0, attack: 5, defense: 3, speed: 5, exp: 10, skills: ['たいあたり', '様子をうかがう'] },
            // Bランク
            goblin: { name: 'ゴブリン', hp: 50, mp: 20, attack: 8, defense: 5, speed: 7, exp: 25, skills: ['剣で叩く', 'プチファイヤー', 'ヒール'] },
            // Aランク
            orc: { name: 'オーク', hp: 80, mp: 30, attack: 12, defense: 8, speed: 6, exp: 45, skills: ['思いっきり棍棒を振り下ろす', 'ハイヒール', 'ブラックファイヤー', '身を守る'] },
            // Sランク
            dragon: { name: 'ドラゴン', hp: 150, mp: 100, attack: 20, defense: 15, speed: 12, exp: 70, skills: ['火を吐く', '尻尾で薙ぎ払う', '空から体当たり', 'キロファイヤー', 'フリーガ'] },
            // 特Sランク（SSランク）
            demonLord: { name: '魔王', hp: 200, mp: 150, attack: 25, defense: 20, speed: 18, exp: 99, skills: ['ダークサンダー', 'メガファイヤー', 'スーパーヒール', 'キロフリーガ', '怪しげな杖を振り回す', '邪眼'] },



            //Cランク
            zombie: { name: 'ゾンビ', hp: 40, mp: 0, attack: 6, defense: 4, speed: 3, exp: 12, skills: ['かみつく', 'うめき声をあげる'] },

            bat: { name: 'コウモリ', hp: 10, mp: 10, attack: 4, defense: 2, speed: 15, exp: 8, skills: ['超音波攻撃', '羽ばたき'] },



            //Bランク
            wolf: { name: 'ウルフ', hp: 60, mp: 30, attack: 10, defense: 6, speed: 12, exp: 26, skills: ['牙で噛みつく', '遠吠え', 'スピードアップ'] },

            skeleton: { name: 'スケルトン', hp: 70, mp: 40, attack: 11, defense: 7, speed: 8, skills: ['骨の剣で斬りつける', 'ボーンアロー', '骨を投げつける'] },



            // Aランク
            golem: { name: 'ゴーレム', hp: 120, mp: 50, attack: 18, defense: 16, speed: 4, exp: 39, skills: ['岩拳', '地面を踏み鳴らす', 'ストーンウォール', '巨石投げ'] },

            minotaur: { name: 'ミノタウロス', hp: 130, mp: 60, attack: 22, defense: 12, speed: 9, exp: 35, skills: ['斧で切り裂く', '角で突進', 'バーサーク', '地面を蹴り上げる'] },

            medusa: { name: 'メデューサ', hp: 110, mp: 80, attack: 16, defense: 10, speed: 14, exp: 40, skills: ['石化の視線', '蛇の毒牙', 'ペトリファイ', '蛇髪の鞭打ち'] },


            // Sランク
            chimera: { name: 'キメラ', hp: 160, mp: 90, attack: 23, defense: 14, speed: 13, exp: 75, skills: ['獅子頭の咆哮', '山羊頭の炎', '蛇尾の毒液', 'トリプルアタック', '翼による突風'] },

            kraken: { name: 'クラーケン', hp: 180, mp: 110, attack: 24, defense: 18, speed: 7, exp: 70, skills: ['触手で絞める', '巨大な波を起こす', '墨吐き', 'ウォーターキャノン', '海底への引きずり込み'] },

            phoenix: { name: 'フェニックス', hp: 170, mp: 130, attack: 21, defense: 16, speed: 16, exp: 80, skills: ['炎の羽根攻撃', '灰からの復活', 'フレイムバースト', '太陽光線', '時を巻き戻す'] },

            vampireLord: { name: 'ヴァンパイアロード', hp: 190, mp: 120, attack: 22, defense: 17, exp: 67, speed: 65, skills: ['血液吸収', 'コウモリに変身', 'ダークミスト', '催眠術', 'ブラッドムーン'] },

            cerberus: { name: 'ケルベロス', hp: 210, mp: 100, attack: 26, defense: 19, speed: 14, exp: 73, skills: ['三つ首の噛みつき', '地獄の業火', 'トリプルハウル', '魂を食らう', 'アンダーワールドゲート'] },



            // 特Sランク(SSランク)
            lich: { name: 'リッチ', hp: 220, mp: 180, attack: 23, defense: 21, speed: 11, exp: 86, skills: ['デスカース', 'ソウルドレイン', 'アンデッドサモン', 'タイムストップ', '魔法の杖で打撃', '不死の再生'] },

            eldritchHorror: { name: 'エルドリッチホラー', hp: 250, mp: 200, attack: 28, defense: 22, speed: 10, exp: 96, skills: ['コズミックホラー', '触手攻撃', 'マインドブレイク', 'リアリティワープ', '異次元への引き込み', '狂気の凝視'] },

            ancientMachineGod: { name: '古代機械神', hp: 300, mp: 250, attack: 30, defense: 25, speed: 20, exp: 100, skills: ['オーバーロード', 'レーザー光線', 'タイムパラドックス', 'ナノマシンリペア', '重力制御', 'データ改竄'] }
        };

        const items = {
            healingPotion: { name: '回復薬', effect: 'hp', value: 50 },
            manaPotion: { name: 'マナポーション', effect: 'mp', value: 30 },
            attackBoost: { name: '攻撃力増強剤', effect: 'attack', value: 5, duration: 3 },
            defenseBoost: { name: '防御力増強剤', effect: 'defense', value: 5, duration: 3 }
        };

        function displayMessage(message, className = '') {
            const p = document.createElement('p');
            p.textContent = message;
            p.className = className;
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
        }

        function updateStatus() {
            if (player) {
                playerStatusDisplay.innerHTML = `
                    <h3>${player.name} (Lv.${player.level})</h3>
                    <p>HP: ${player.hp}/${classes[player.class].hp}</p>
                    <p>MP: ${player.mp}/${classes[player.class].mp}</p>
                    <p>攻撃力: ${player.attack}</p>
                    <p>防御力: ${player.defense}</p>
                    <p>素早さ: ${player.speed}</p>
                    <p>経験値: ${player.exp}</p>
                `;
            } else {
                playerStatusDisplay.innerHTML = '';
            }

            if (currentEnemy) {
                enemyStatusDisplay.innerHTML = `
                    <h3>${currentEnemy.name}</h3>
                    <p>HP: ${currentEnemy.hp}/${enemies[currentEnemy.type].hp}</p>
                    <p>MP: ${currentEnemy.mp}/${enemies[currentEnemy.type].mp}</p>
                    <p>攻撃力: ${currentEnemy.attack}</p>
                    <p>防御力: ${currentEnemy.defense}</p>
                    <p>素早さ: ${currentEnemy.speed}</p>
                `;
            } else {
                enemyStatusDisplay.innerHTML = '';
            }
        }

        function startGame() {
            displayMessage('===== バトルアリーナ - 勇者の試練 =====');
            displayMessage('1. ゲームスタート');
            displayMessage('2. ゲーム説明');
            displayMessage('3. 終了');
            displayMessage('選択してください (1-3):');
        }

        function createCharacter() {
            displayMessage('職業を選択してください:');
            displayMessage('1. 戦士');
            displayMessage('2. 魔法使い');
            displayMessage('3. 盗賊');
        }

        function startBattle() {
            const enemyKeys = Object.keys(enemies);
            const randomEnemyType = enemyKeys[Math.floor(Math.random() * enemyKeys.length)];
            currentEnemy = { ...enemies[randomEnemyType], type: randomEnemyType };
            displayMessage(`${currentEnemy.name}が現れた！`, 'enemy-appear');
            updateStatus();
            displayBattleMenu();
        }

        function displayBattleMenu() {
            displayMessage('行動を選択してください:');
            displayMessage('1. 攻撃');
            displayMessage('2. スキル');
            displayMessage('3. アイテム');
            displayMessage('4. 逃げる');
        }

        function performAction(action) {
    switch (action) {
        case '1': // 攻撃を選んだ場合
            attack();  // 攻撃を実行
            break;
        case '2': // スキルを選んだ場合
            displaySkillMenu();  // スキルメニューを表示
            gameState = 'skill-selection';  // スキル選択状態に変更
            break;
        case '3': // アイテムを選んだ場合
            displayItemMenu();  // アイテムメニューを表示
            gameState = 'item-selection';  // アイテム選択状態に変更
            break;
        case '4': // 逃げるを選んだ場合
            escape();  // 逃げる処理
            break;
        default:
            displayMessage('無効な選択です。もう一度選んでください。');
            displayBattleMenu();  // 無効な選択時に再度メニューを表示
    }
}



        function attack() {
            const damage = Math.max(1, player.attack - currentEnemy.defense);
            currentEnemy.hp -= damage;
            displayMessage(`${player.name}の攻撃！${currentEnemy.name}に${damage}のダメージ！`, 'player-action');
            
            if (currentEnemy.hp <= 0) {
                endBattle(true);
            } else {
                enemyTurn();
            }
        }

        function displaySkillMenu() {
            displayMessage('使用するスキルを選択してください:');
            player.skills.forEach((skill, index) => {
                displayMessage(`${index + 1}. ${skill}`);
            });
        }

        function useSkill(skillIndex) {
            const skill = player.skills[skillIndex];
            let damage = 0;
            let mpCost = 10;

            switch (skill) {
                case '剣撃':
                    damage = Math.max(1, player.attack * 1.5 - currentEnemy.defense);
                    break;
                case 'ファイアボール':
                    damage = Math.max(1, player.attack * 2 - currentEnemy.defense);
                    mpCost = 15;
                    break;
                case '急所突き':
                    damage = Math.max(1, player.attack * 1.8 - currentEnemy.defense);
                    break;
                case '盾防御':
                    player.defense += 5;
                    displayMessage(`${player.name}は盾で身を守った！防御力が上昇した！`, 'player-action');
                    setTimeout(() => {
                        player.defense -= 5;
                        displayMessage('盾防御の効果が切れた。', 'player-action');
                    }, 20000);
                    enemyTurn();
                    return;
                case '突進':
                    damage = Math.max(1, player.attack * 2.2 - currentEnemy.defense);
                    player.hp -= Math.floor(player.hp * 0.1);
                    displayMessage(`${player.name}は突進攻撃を行った！自身にもダメージを受けた。`, 'player-action');
                    break;
                case 'ヒール':
                    const healAmount = Math.floor(player.mp * 0.5);
                    player.hp = Math.min(player.hp + healAmount, classes[player.class].hp);
                    mpCost = 20;
                    displayMessage(`${player.name}はヒールを唱えた！HPが${healAmount}回復した！`, 'player-action');
                    enemyTurn();
                    return;
                case 'マナシールド':
                    player.defense += 10;
                    mpCost = 25;
                    displayMessage(`${player.name}はマナシールドを展開した！防御力が大きく上昇した！`, 'player-action');
                    setTimeout(() => {
                        player.defense -= 10;
                        displayMessage('マナシールドの効果が切れた。', 'player-action');
                    }, 30000);
                    enemyTurn();
                    return;
                case '毒霧':
                    damage = Math.max(1, player.attack - currentEnemy.defense);
                    currentEnemy.attack -= 2;
                    displayMessage(`${player.name}は毒霧を撒いた！${currentEnemy.name}の攻撃力が低下した！`, 'player-action');
                    setTimeout(() => {
                        currentEnemy.attack += 2;
                        displayMessage('毒霧の効果が切れた。', 'player-action');
                    }, 3000);
                    break;
                case '回避':
                    player.speed += 5;
                    displayMessage(`${player.name}は回避態勢に入った！素早さが上昇した！`, 'player-action');
                    setTimeout(() => {
                        player.speed -= 5;
                        displayMessage('回避の効果が切れた。', 'player-action');
                    }, 30000);
                    enemyTurn();
                    return;
            }


    // MP不足の場合の処理
    if (player.mp < mpCost) {
        displayMessage('MPが足りません！');
        displayBattleMenu();  // エラーメッセージ後、再度メニューを表示
        return;
    }

    player.mp -= mpCost;  // MPを消費
    currentEnemy.hp -= damage;  // ダメージを与える
    displayMessage(`${player.name}の${skill}！${currentEnemy.name}に${damage}のダメージ！`, 'player-action');

    if (currentEnemy.hp <= 0) {
        endBattle(true);  // 敵を倒した場合
    } else {
        enemyTurn();  // 敵のターンへ
    }
}

        function displayItemMenu() {
            displayMessage('使用するアイテムを選択してください:');
            Object.values(items).forEach((item, index) => {
                displayMessage(`${index + 1}. ${item.name}`);
            });
        }

        function useItem(itemIndex) {
            const item = Object.values(items)[itemIndex];
            if (item.effect === 'hp') {
                player.hp = Math.min(player.hp + item.value, classes[player.class].hp);
                displayMessage(`${item.name}を使用しました。HPが${item.value}回復しました。`, 'item-use');
            } else if (item.effect === 'mp') {
                player.mp = Math.min(player.mp + item.value, classes[player.class].mp);
                displayMessage(`${item.name}を使用しました。MPが${item.value}回復しました。`, 'item-use');
            } else {
                player[item.effect] += item.value;
                displayMessage(`${item.name}を使用しました。${item.effect}が${item.value}上昇しました。`, 'item-use');
                setTimeout(() => {
                    player[item.effect] -= item.value;
                    displayMessage(`${item.name}の効果が切れました。`, 'item-use');
                }, item.duration * 1000);
            }
            enemyTurn();
        }

        function escape() {
            if (Math.random() < 0.5) {
                displayMessage('逃げ切れた！');
                startBattle();
            } else {
                displayMessage('逃げられなかった！');
                enemyTurn();
            }
        }

        function enemyTurn() {
            const skill = currentEnemy.skills[Math.floor(Math.random() * currentEnemy.skills.length)];
            let damage = Math.max(1, currentEnemy.attack - player.defense);

            switch (skill) {
                case 'たいあたり':
                    damage *= 1.2;
                    break;
                case '様子をうかがう':
                    currentEnemy.defense += 2;
                    displayMessage(`${currentEnemy.name}は様子をうかがっている。防御力が上がった！`, 'enemy-appear');
                    setTimeout(() => {
                        currentEnemy.defense -= 2;
                    }, 10000);
                    updateStatus();
                    displayBattleMenu();
                    return;
                case '剣で叩く':
                    damage *= 1.3;
                    break;
                case 'プチファイヤー':
                    damage *= 1.5;
                    currentEnemy.mp -= 5;
                    break;
                case 'ヒール':
                    if (currentEnemy.mp >= 10) {
                        const healAmount = Math.floor(currentEnemy.hp * 0.2);
                        currentEnemy.hp = Math.min(currentEnemy.hp + healAmount, enemies[currentEnemy.type].hp);
                        currentEnemy.mp -= 10;
                        displayMessage(`${currentEnemy.name}はヒールを唱えた！HPが${healAmount}回復した！`, 'enemy-appear');
                        updateStatus();
                        displayBattleMenu();
                        return;
                    }
                    break;
                case '思いっきり棍棒を振り下ろす':
                    damage *= 1.8;
                    break;
                case 'ハイヒール':
                    if (currentEnemy.mp >= 20) {
                        const healAmount = Math.floor(currentEnemy.hp * 0.4);
                        currentEnemy.hp = Math.min(currentEnemy.hp + healAmount, enemies[currentEnemy.type].hp);
                        currentEnemy.mp -= 20;
                        displayMessage(`${currentEnemy.name}はハイヒールを唱えた！HPが${healAmount}回復した！`, 'enemy-appear');
                        updateStatus();
                        displayBattleMenu();
                        return;
                    }
                    break;
                case 'ブラックファイヤー':
                    if (currentEnemy.mp >= 15) {
                        damage *= 2;
                        currentEnemy.mp -= 15;
                    }
                    break;
                case '身を守る':
                    currentEnemy.defense += 5;
                    displayMessage(`${currentEnemy.name}は身を守った！防御力が上がった！`, 'enemy-appear');
                    setTimeout(() => {
                        currentEnemy.defense -= 5;
                    }, 3000);
                    updateStatus();
                    displayBattleMenu();
                    return;
                case '火を吐く':
                    damage *= 2.2;
                    break;
                case '尻尾で薙ぎ払う':
                    damage *= 1.8;
                    player.speed -= 2;
                    displayMessage(`${currentEnemy.name}の尻尾攻撃！${player.name}の素早さが下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.speed += 2;
                    }, 3000);
                    break;
                case '空から体当たり':
                    damage *= 2.5;
                    currentEnemy.hp -= Math.floor(currentEnemy.hp * 0.1);
                    displayMessage(`${currentEnemy.name}は空から体当たりをした！自身にもダメージを受けた。`, 'enemy-appear');
                    break;
                case 'キロファイヤー':
                    if (currentEnemy.mp >= 30) {
                        damage *= 3;
                        currentEnemy.mp -= 30;
                    }
                    break;
                case 'フリーガ':
                    if (currentEnemy.mp >= 25) {
                        damage *= 2.5;
                        player.speed -= 5;
                        currentEnemy.mp -= 25;
                        displayMessage(`${currentEnemy.name}はフリーガを唱えた！${player.name}の素早さが大きく下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 5;
                        }, 3000);
                    }
                    break;
                case 'ダークサンダー':
                    if (currentEnemy.mp >= 40) {
                        damage *= 3.5;
                        currentEnemy.mp -= 40;
                    }
                    break;
                case 'メガファイヤー':
                    if (currentEnemy.mp >= 50) {
                        damage *= 4;
                        currentEnemy.mp -= 50;
                    }
                    break;
                case 'スーパーヒール':
                    if (currentEnemy.mp >= 60) {
                        const healAmount = Math.floor(currentEnemy.hp * 0.7);
                        currentEnemy.hp = Math.min(currentEnemy.hp + healAmount, enemies[currentEnemy.type].hp);
                        currentEnemy.mp -= 60;
                        displayMessage(`${currentEnemy.name}はスーパーヒールを唱えた！HPが${healAmount}回復した！`, 'enemy-appear');
                        updateStatus();
                        displayBattleMenu();
                        return;
                    }
                    break;
                case 'キロフリーガ':
                    if (currentEnemy.mp >= 70) {
                        damage *= 3.5;
                        player.speed -= 10;
                        currentEnemy.mp -= 70;
                        displayMessage(`${currentEnemy.name}はキロフリーガを唱えた！${player.name}の素早さが激減した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 10;
                        }, 3000);
                    }
                    break;
                case '怪しげな杖を振り回す':
                    const randomEffect = Math.random();
                    if (randomEffect < 0.3) {
                        damage *= 2;
                        displayMessage(`${currentEnemy.name}の杖から強力な魔力が放出された！`, 'enemy-appear');
                    } else if (randomEffect < 0.6) {
                        currentEnemy.hp += Math.floor(currentEnemy.hp * 0.2);
                        displayMessage(`${currentEnemy.name}の杖が輝き、HPが回復した！`, 'enemy-appear');
                    } else {
                        currentEnemy.mp += 30;
                        displayMessage(`${currentEnemy.name}の杖が光り、MPが回復した！`, 'enemy-appear');
                    }
                    break;
                case '邪眼':
                    if (Math.random() < 0.3) {
                        player.attack -= 5;
                        player.defense -= 5;
                        displayMessage(`${currentEnemy.name}の邪眼により、${player.name}の攻撃力と防御力が低下した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.attack += 5;
                            player.defense += 5;
                        }, 3000);
                    } else {
                        displayMessage(`${currentEnemy.name}の邪眼...しかし効果がなかった！`, 'enemy-appear');
                    }
                    break;
                case 'かみつく':
                    damage *= 1.3;
                    break;
                case 'うめき声をあげる':
                    player.attack -= 2;
                    displayMessage(`${currentEnemy.name}のうめき声で${player.name}の攻撃力が下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.attack += 2;
                    }, 3000);
                    break;
                case '超音波攻撃':
                    damage *= 1.4;
                    if (Math.random() < 0.3) {
                        player.speed -= 3;
                        displayMessage(`${currentEnemy.name}の超音波で${player.name}の素早さが下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 3;
                        }, 3000);
                    }
                    break;
                case '羽ばたき':
                    currentEnemy.defense += 3;
                    displayMessage(`${currentEnemy.name}は羽ばたいて身を守った！防御力が上がった！`, 'enemy-appear');
                    setTimeout(() => {
                        currentEnemy.defense -= 3;
                    }, 3000);
                    break;
                case '牙で噛みつく':
                    damage *= 1.6;
                    break;
                case '遠吠え':
                    currentEnemy.attack += 3;
                    displayMessage(`${currentEnemy.name}の遠吠えで攻撃力が上がった！`, 'enemy-appear');
                    setTimeout(() => {
                        currentEnemy.attack -= 3;
                    }, 3000);
                    break;
                case 'スピードアップ':
                    if (currentEnemy.mp >= 10) {
                        currentEnemy.speed += 5;
                        currentEnemy.mp -= 10;
                        displayMessage(`${currentEnemy.name}はスピードアップを唱えた！素早さが上がった！`, 'enemy-appear');
                        setTimeout(() => {
                            currentEnemy.speed -= 5;
                        }, 3000);
                    }
                    break;
                case '骨の剣で斬りつける':
                    damage *= 1.5;
                    break;
                case 'ボーンアロー':
                    if (currentEnemy.mp >= 15) {
                        damage *= 1.8;
                        currentEnemy.mp -= 15;
                    }
                    break;
                case '骨を投げつける':
                    damage *= 1.3;
                    if (Math.random() < 0.2) {
                        player.speed -= 2;
                        displayMessage(`${currentEnemy.name}の骨が${player.name}に当たり、素早さが下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 2;
                        }, 3000);
                    }
                    break;
                case '岩拳':
                    damage *= 2;
                    break;
                case '地面を踏み鳴らす':
                    damage *= 1.5;
                    player.speed -= 3;
                    displayMessage(`${currentEnemy.name}の地響きで${player.name}の素早さが下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.speed += 3;
                    }, 3000);
                    break;
                case 'ストーンウォール':
                    if (currentEnemy.mp >= 20) {
                        currentEnemy.defense += 10;
                        currentEnemy.mp -= 20;
                        displayMessage(`${currentEnemy.name}はストーンウォールを展開した！防御力が大きく上昇した！`, 'enemy-appear');
                        setTimeout(() => {
                            currentEnemy.defense -= 10;
                        }, 3000);
                    }
                    break;
                case '巨石投げ':
                    damage *= 2.2;
                    break;
                case '斧で切り裂く':
                    damage *= 1.9;
                    break;
                case '角で突進':
                    damage *= 2.1;
                    break;
                case 'バーサーク':
                    if (currentEnemy.mp >= 30) {
                        currentEnemy.attack *= 2;
                        currentEnemy.defense /= 2;
                        currentEnemy.mp -= 30;
                        displayMessage(`${currentEnemy.name}はバーサーク状態になった！攻撃力が倍になったが防御力が半減した！`, 'enemy-appear');
                        setTimeout(() => {
                            currentEnemy.attack /= 2;
                            currentEnemy.defense *= 2;
                        }, 3000);
                    }
                    break;
                case '地面を蹴り上げる':
                    damage *= 1.7;
                    if (Math.random() < 0.3) {
                        player.speed -= 4;
                        displayMessage(`${currentEnemy.name}の攻撃で${player.name}のバランスが崩れ、素早さが下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 4;
                        }, 3000);
                    }
                    break;
                case '石化の視線':
                    if (Math.random() < 0.2) {
                        player.speed = 0;
                        displayMessage(`${currentEnemy.name}の石化の視線で${player.name}は動けなくなった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed = classes[player.class].speed;
                        }, 3000);
                    } else {
                        displayMessage(`${currentEnemy.name}の石化の視線...しかし${player.name}は回避した！`, 'enemy-appear');
                    }
                    break;
                case '蛇の毒牙':
                    damage *= 1.4;
                    if (Math.random() < 0.3) {
                        player.attack -= 3;
                        displayMessage(`${currentEnemy.name}の毒で${player.name}の攻撃力が下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.attack += 3;
                        }, 3000);
                    }
                    break;
                case 'ペトリファイ':
                    if (currentEnemy.mp >= 25) {
                        if (Math.random() < 0.4) {
                            player.speed = 0;
                            player.defense = 0;
                            currentEnemy.mp -= 25;
                            displayMessage(`${currentEnemy.name}のペトリファイで${player.name}は完全に石化した！`, 'enemy-appear');
                            setTimeout(() => {
                                player.speed = classes[player.class].speed;
                                player.defense = classes[player.class].defense;
                            }, 3000);
                        } else {
                            displayMessage(`${currentEnemy.name}のペトリファイ...しかし${player.name}は耐性を示した！`, 'enemy-appear');
                        }
                    }
                    break;
                case '蛇髪の鞭打ち':
                    damage *= 1.6;
                    if (Math.random() < 0.25) {
                        player.speed -= 3;
                        displayMessage(`${currentEnemy.name}の蛇髪が${player.name}に絡みつき、素早さが下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 3;
                        }, 3000);
                    }
                    break;
                case '獅子頭の咆哮':
                    player.attack -= 5;
                    player.defense -= 5;
                    displayMessage(`${currentEnemy.name}の咆哮で${player.name}の攻撃力と防御力が下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.attack += 5;
                        player.defense += 5;
                    }, 3000);
                    break;
                case '山羊頭の炎':
                    damage *= 2.3;
                    break;
                case '蛇尾の毒液':
                    damage *= 1.5;
                    if (Math.random() < 0.4) {
                        player.speed -= 4;
                        player.attack -= 4;
                        displayMessage(`${currentEnemy.name}の毒で${player.name}の素早さと攻撃力が下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 4;
                            player.attack += 4;
                        }, 3000);
                    }
                    break;
                case 'トリプルアタック':
                    if (currentEnemy.mp >= 30) {
                        damage *= 3;
                        currentEnemy.mp -= 30;
                        displayMessage(`${currentEnemy.name}のトリプルアタック！3回連続で攻撃された！`, 'enemy-appear');
                    }
                    break;
                case '翼による突風':
                    damage *= 1.7;
                    player.speed -= 3;
                    displayMessage(`${currentEnemy.name}の突風で${player.name}の素早さが下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.speed += 3;
                    }, 3000);
                    break;
                case '触手で絞める':
                    damage *= 1.8;
                    player.speed -= 4;
                    displayMessage(`${currentEnemy.name}の触手で${player.name}の動きが制限された！素早さが下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.speed += 4;
                    }, 3000);
                    break;
                case '巨大な波を起こす':
                    damage *= 2.5;
                    break;
                case '墨吐き':
                    player.attack -= 6;
                    player.defense -= 6;
                    displayMessage(`${currentEnemy.name}の墨で${player.name}の視界が遮られた！攻撃力と防御力が下がった！`, 'enemy-appear');
                    setTimeout(() => {
                        player.attack += 6;
                        player.defense += 6;
                    }, 3000);
                    break;
                case 'ウォーターキャノン':
                    if (currentEnemy.mp >= 35) {
                        damage *= 3.2;
                        currentEnemy.mp -= 35;
                    }
                    break;
                case '海底への引きずり込み':
                    if (Math.random() < 0.3) {
                        player.hp -= Math.floor(player.hp * 0.2);
                        displayMessage(`${currentEnemy.name}に海底へ引きずり込まれた！${player.name}は大きなダメージを受けた！`, 'enemy-appear');
                    } else {
                        displayMessage(`${currentEnemy.name}の引きずり込み...しかし${player.name}は回避した！`, 'enemy-appear');
                    }
                    break;
                case '炎の羽根攻撃':
                    damage *= 2.4;
                    break;
                case '灰からの復活':
                    if (currentEnemy.hp < enemies[currentEnemy.type].hp * 0.5) {
                    let recoveryAmount = Math.floor(enemies[currentEnemy.type].hp * 0.2);
                    if (Math.random() < 0.2) {  // 20%の確率で成功
                        currentEnemy.hp += recoveryAmount;
                        displayMessage(`${currentEnemy.name}は灰から復活し、HPが${recoveryAmount}回復した！`, 'enemy-appear');
                    } else {
                        currentEnemy.hp += 40;
                        displayMessage(`${currentEnemy.name}は灰からの復活し、HPが40回復した。`, 'enemy-appear');
                    }
                } else {
                    currentEnemy.hp += Math.floor(enemies[currentEnemy.type].hp * 0.3);
                    displayMessage(`${currentEnemy.name}は灰から力を得て、HPが回復した！`, 'enemy-appear');
                }
                break;
                case 'フレイムバースト':
                    if (currentEnemy.mp >= 40) {
                        damage *= 3.5;
                        currentEnemy.mp -= 40;
                    }
                    break;
                case '太陽光線':
                    damage *= 3;
                    if (Math.random() < 0.3) {
                        player.speed -= 5;
                        displayMessage(`${currentEnemy.name}の眩しい光で${player.name}の動きが鈍った！素早さが下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 5;
                        }, 3000);
                    }
                    break;
                case '時を巻き戻す':
                    if (currentEnemy.mp >= 50) {
                        currentEnemy.hp = enemies[currentEnemy.type].hp;
                        currentEnemy.mp -= 50;
                        displayMessage(`${currentEnemy.name}は時を巻き戻し、HPが全回復した！`, 'enemy-appear');
                    }
                    break;
                case '血液吸収':
                    const drainAmount = Math.floor(damage * 0.5);
                    currentEnemy.hp = Math.min(currentEnemy.hp + drainAmount, enemies[currentEnemy.type].hp);
                    displayMessage(`${currentEnemy.name}は${player.name}の血を吸い、${drainAmount}のHPを回復した！`, 'enemy-appear');
                    break;
                case 'コウモリに変身':
                    currentEnemy.speed += 8;
                    displayMessage(`${currentEnemy.name}はコウモリに変身し、素早さが大幅に上昇した！`, 'enemy-appear');
                    setTimeout(() => {
                        currentEnemy.speed -= 8;
                    }, 3000);
                    break;
                case 'ダークミスト':
                    if (currentEnemy.mp >= 30) {
                        player.attack -= 7;
                        player.defense -= 7;
                        currentEnemy.mp -= 30;
                        displayMessage(`${currentEnemy.name}のダークミストで${player.name}の攻撃力と防御力が大きく下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.attack += 7;
                            player.defense += 7;
                        }, 3000);
                    }
                    break;
                case '催眠術':
                    if (Math.random() < 0.3) {
                        player.speed = 0;
                        displayMessage(`${currentEnemy.name}の催眠術で${player.name}は眠ってしまった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed = classes[player.class].speed;
                        }, 3000);
                    } else {
                        displayMessage(`${currentEnemy.name}の催眠術...しかし${player.name}は耐え抜いた！`, 'enemy-appear');
                    }
                    break;
                case 'ブラッドムーン':
                    if (currentEnemy.mp >= 60) {
                        damage *= 4;
                        currentEnemy.hp += Math.floor(damage * 0.5);
                        currentEnemy.mp -= 60;
                        displayMessage(`${currentEnemy.name}はブラッドムーンの力を解放した！強力な攻撃と共にHPも回復した！`, 'enemy-appear');
                    }
                    break;
                case '三つ首の噛みつき':
                    damage *= 2.7;
                    break;
                case '地獄の業火':
                    damage *= 3;
                    if (Math.random() < 0.4) {
                        player.defense -= 5;
                        displayMessage(`${currentEnemy.name}の業火で${player.name}の防御力が下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.defense += 5;
                        }, 3000);
                    }
                    break;
                case 'トリプルハウル':
                    if (currentEnemy.mp >= 40) {
                        player.attack -= 8;
                        player.defense -= 8;
                        player.speed -= 8;
                        currentEnemy.mp -= 40;
                        displayMessage(`${currentEnemy.name}のトリプルハウルで${player.name}の全ステータスが下がった！`, 'enemy-appear');
                        setTimeout(() => {
                            player.attack += 8;
                            player.defense += 8;
                            player.speed += 8;
                        }, 3000);
                    }
                    break;
                case '魂を食らう':
                    const soulDrainAmount = Math.floor(player.hp * 0.1);
                    player.hp -= soulDrainAmount;
                    currentEnemy.hp += soulDrainAmount;
                    displayMessage(`${currentEnemy.name}は${player.name}の魂を食らい、${soulDrainAmount}のHPを奪った！`, 'enemy-appear');
                    break;
                case 'アンダーワールドゲート':
                    if (currentEnemy.mp >= 70) {
                        damage *= 4.5;
                        currentEnemy.mp -= 70;
                        displayMessage(`${currentEnemy.name}はアンダーワールドの門を開いた！強大な力が${player.name}を襲う！`, 'enemy-appear');
                    }
                    break;
                case 'デスカース':
                    if (currentEnemy.mp >= 50) {
                        player.hp = Math.max(1, Math.floor(player.hp * 0.7));
                        currentEnemy.mp -= 50;
                        displayMessage(`${currentEnemy.name}のデスカースで${player.name}のHPが大幅に減少した！`, 'enemy-appear');
                    }
                    break;
                case 'ソウルドレイン':
                    if (currentEnemy.mp >= 40) {
                        const drainedHP = Math.floor(player.hp * 0.2);
                        player.hp -= drainedHP;
                        currentEnemy.hp += drainedHP;
                        currentEnemy.mp -= 40;
                        displayMessage(`${currentEnemy.name}は${player.name}の生命力を吸収し、${drainedHP}のHPを奪った！`, 'enemy-appear');
                    }
                    break;
                case 'アンデッドサモン':
                    if (currentEnemy.mp >= 60) {
                        damage *= 2;
                        currentEnemy.defense += 10;
                        currentEnemy.mp -= 60;
                        displayMessage(`${currentEnemy.name}はアンデッドを召喚した！攻撃力が上昇し、防御力も高まった！`, 'enemy-appear');
                        setTimeout(() => {
                            currentEnemy.defense -= 10;
                        }, 3000);
                    }
                    break;
                case 'タイムストップ':
                    if (currentEnemy.mp >= 80) {
                        player.speed = 0;
                        currentEnemy.mp -= 80;
                        displayMessage(`${currentEnemy.name}は時を止めた！${player.name}は行動できない！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed = classes[player.class].speed;
                        }, 3000);
                    }
                    break;
                case '魔法の杖で打撃':
                    damage *= 2.2;
                    if (Math.random() < 0.3) {
                        player.mp = Math.max(0, player.mp - 20);
                        displayMessage(`${currentEnemy.name}の魔法の杖の力で${player.name}のMPが減少した！`, 'enemy-appear');
                    }
                    break;
                case '不死の再生':
                    currentEnemy.hp += Math.floor(enemies[currentEnemy.type].hp * 0.2);
                    displayMessage(`${currentEnemy.name}は不死の力で再生した！HPが回復した！`, 'enemy-appear');
                    break;
                case 'コズミックホラー':
                    if (currentEnemy.mp >= 100) {
                        damage *= 5;
                        player.attack -= 10;
                        player.defense -= 10;
                        player.speed -= 10;
                        currentEnemy.mp -= 100;
                        displayMessage(`${currentEnemy.name}はコズミックホラーを解き放った！${player.name}は恐怖で全能力が低下した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.attack += 10;
                            player.defense += 10;
                            player.speed += 10;
                        }, 3000);
                    }
                    break;
                case '触手攻撃':
                    damage *= 2.5;
                    if (Math.random() < 0.4) {
                        player.speed -= 7;
                        displayMessage(`${currentEnemy.name}の触手が${player.name}を絡め取った！素早さが大きく低下した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed += 7;
                        }, 3000);
                    }
                    break;
                case 'マインドブレイク':
                    if (currentEnemy.mp >= 70) {
                        player.attack = Math.floor(player.attack * 0.5);
                        player.mp = Math.floor(player.mp * 0.5);
                        currentEnemy.mp -= 70;
                        displayMessage(`${currentEnemy.name}のマインドブレイクで${player.name}の精神が崩壊！攻撃力とMPが半減した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.attack = classes[player.class].attack;
                            player.mp = classes[player.class].mp;
                        }, 3000);
                    }
                    break;
                case 'リアリティワープ':
                    if (currentEnemy.mp >= 90) {
                        const warpEffect = Math.random();
                        if (warpEffect < 0.3) {
                            player.hp = 1;
                            displayMessage(`${currentEnemy.name}は現実を歪めた！${player.name}のHPが1になった！`, 'enemy-appear');
                        } else if (warpEffect < 0.6) {
                            player.mp = 0;
                            displayMessage(`${currentEnemy.name}は現実を歪めた！${player.name}のMPが0になった！`, 'enemy-appear');
                        } else {
                            player.attack = 1;
                            player.defense = 1;
                            player.speed = 1;
                            displayMessage(`${currentEnemy.name}は現実を歪めた！${player.name}の全能力値が1になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.attack = classes[player.class].attack;
                                player.defense = classes[player.class].defense;
                                player.speed = classes[player.class].speed;
                            }, 3000);
                        }
                        currentEnemy.mp -= 90;
                    }
                    break;
                case '異次元への引き込み':
                    if (Math.random() < 0.2) {
                        player.hp = Math.floor(player.hp * 0.5);
                        displayMessage(`${currentEnemy.name}は${player.name}を異次元に引き込んだ！HPが半減した！`, 'enemy-appear');
                    } else {
                        displayMessage(`${currentEnemy.name}は${player.name}を異次元に引き込もうとしたが失敗した！`, 'enemy-appear');
                    }
                    break;
                case '狂気の凝視':
                    if (Math.random() < 0.3) {
                        const randomStat = Math.random();
                        if (randomStat < 0.33) {
                            player.attack = 0;
                            displayMessage(`${currentEnemy.name}の狂気の凝視で${player.name}の攻撃力が0になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.attack = classes[player.class].attack;
                            }, 3000);
                        } else if (randomStat < 0.66) {
                            player.defense = 0;
                            displayMessage(`${currentEnemy.name}の狂気の凝視で${player.name}の防御力が0になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.defense = classes[player.class].defense;
                            }, 3000);
                        } else {
                            player.speed = 0;
                            displayMessage(`${currentEnemy.name}の狂気の凝視で${player.name}の素早さが0になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.speed = classes[player.class].speed;
                            }, 3000);
                        }
                    } else {
                        displayMessage(`${currentEnemy.name}の狂気の凝視...しかし${player.name}は耐え抜いた！`, 'enemy-appear');
                    }
                    break;
                case 'オーバーロード':
                    if (currentEnemy.mp >= 120) {
                        damage *= 6;
                        currentEnemy.hp -= Math.floor(currentEnemy.hp * 0.3);
                        currentEnemy.mp -= 120;
                        displayMessage(`${currentEnemy.name}はオーバーロード状態になった！凄まじい攻撃力だが、自身も大きなダメージを受けた！`, 'enemy-appear');
                    }
                    break;
                case 'レーザー光線':
                    damage *= 3.5;
                    if (Math.random() < 0.4) {
                        player.defense -= 8;
                        displayMessage(`${currentEnemy.name}のレーザー光線で${player.name}の防御力が大きく低下した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.defense += 8;
                        }, 3000);
                    }
                    break;
                case 'タイムパラドックス':
                    if (currentEnemy.mp >= 100) {
                        const paradoxEffect = Math.random();
                        if (paradoxEffect < 0.5) {
                            player.hp = Math.max(1, Math.floor(player.hp * 0.1));
                            displayMessage(`${currentEnemy.name}のタイムパラドックスで${player.name}のHPが激減した！`, 'enemy-appear');
                        } else {
                            currentEnemy.hp = Math.max(1, Math.floor(currentEnemy.hp * 0.1));
                            displayMessage(`${currentEnemy.name}のタイムパラドックスが逆効果を起こし、自身のHPが激減した！`, 'enemy-appear');
                        }
                        currentEnemy.mp -= 100;
                    }
                    break;
                case 'ナノマシンリペア':
                    if (currentEnemy.mp >= 80) {
                        const repairAmount = Math.floor(enemies[currentEnemy.type].hp * 0.5);
                        currentEnemy.hp = Math.min(currentEnemy.hp + repairAmount, enemies[currentEnemy.type].hp);
                        currentEnemy.mp -= 80;
                        displayMessage(`${currentEnemy.name}はナノマシンで自己修復した！HPが大幅に回復した！`, 'enemy-appear');
                    }
                    break;
                case '重力制御':
                    if (currentEnemy.mp >= 70) {
                        player.speed = Math.floor(player.speed * 0.2);
                        player.attack = Math.floor(player.attack * 0.5);
                        currentEnemy.mp -= 70;
                        displayMessage(`${currentEnemy.name}は重力を操作した！${player.name}の素早さと攻撃力が大幅に低下した！`, 'enemy-appear');
                        setTimeout(() => {
                            player.speed = classes[player.class].speed;
                            player.attack = classes[player.class].attack;
                        }, 3000);
                    }
                    break;
                case 'データ改竄':
                    if (currentEnemy.mp >= 90) {
                        const statToChange = Math.random();
                        if (statToChange < 0.25) {
                            player.attack = 1;
                            displayMessage(`${currentEnemy.name}は${player.name}のデータを改竄した！攻撃力が1になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.attack = classes[player.class].attack;
                            }, 3000);
                        } else if (statToChange < 0.5) {
                            player.defense = 1;
                            displayMessage(`${currentEnemy.name}は${player.name}のデータを改竄した！防御力が1になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.defense = classes[player.class].defense;
                            }, 3000);
                        } else if (statToChange < 0.75) {
                            player.speed = 1;
                            displayMessage(`${currentEnemy.name}は${player.name}のデータを改竄した！素早さが1になった！`, 'enemy-appear');
                            setTimeout(() => {
                                player.speed = classes[player.class].speed;
                            }, 3000);
                        } else {
                            player.mp = 1;
                            displayMessage(`${currentEnemy.name}は${player.name}のデータを改竄した！MPが1になった！`, 'enemy-appear');
                        }
                        currentEnemy.mp -= 90;
                    }
                    break;
            }

            player.hp -= damage;
            displayMessage(`${currentEnemy.name}の${skill}！${player.name}に${damage}のダメージ！`, 'enemy-appear');

            if (player.hp <= 0) {
                endBattle(false);
            } else {
                updateStatus();
                displayBattleMenu();
            }
        }

    function endBattle(playerWon) {
        if (playerWon) {
            const exp = currentEnemy.exp;  // 敵の経験値を取得
            player.exp += exp;
            displayMessage(`${currentEnemy.name}を倒した！${exp}の経験値を獲得！`);
            checkLevelUp();
            startBattle();
        }
        else {
        displayMessage('あなたは倒れた...ゲームオーバー');
        gameState = 'title';
        startGame();
        }
    }

        function checkLevelUp() {
    // 100XPを超えるたびにレベルアップ
    if (player.exp >= 100) {
        player.level++;  // レベルを1上げる
        player.exp -= 100;  // 100XPを消費する

        // ステータスの強化 (HP, MP, 攻撃力, 防御力, 素早さ)
        player.hp += 20;  // HPを10増やす
        player.mp += 5;   // MPを5増やす
        player.attack += 2;  // 攻撃力を2増やす
        player.defense += 2; // 防御力を2増やす
        player.speed += 1;   // 素早さを1増やす

        // メッセージ表示
        displayMessage(`レベルアップ！${player.name}はレベル${player.level}になった！`, 'level-up');

        // ステータス表示を更新
        updateStatus();
    }
}

        input.addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
        const command = input.value.trim();  // ユーザーの入力を取得
        input.value = '';  // 入力欄をクリア

        switch (gameState) {
            case 'title':
                if (command === '1') {
                    gameState = 'character-creation';
                    createCharacter();  // キャラクター作成画面を表示
                } else if (command === '2') {
                    displayMessage('ゲーム説明: このゲームはターン制のテキストRPGです。敵と戦い、経験値を獲得してレベルアップしましょう。');
                    startGame();  // ゲームの説明を表示後、スタート画面に戻る
                } else if (command === '3') {
                    displayMessage('ゲームを終了します。お疲れ様でした！');
                } else {
                    displayMessage('無効な選択です。もう一度選んでください。');
                    startGame();  // 無効な選択の場合、再度スタート画面を表示
                }
                break;

            case 'character-creation':
                if (['1', '2', '3'].includes(command)) {
                    const classNames = ['warrior', 'mage', 'thief'];
                    const selectedClass = classNames[parseInt(command) - 1];
                    player = { ...classes[selectedClass], name: '勇者', level: 1, exp: 0, class: selectedClass };
                    displayMessage(`${player.name}として冒険を始めます！`);
                    gameState = 'battle';  // 戦闘状態に移行
                    startBattle();  // 戦闘開始
                } else {
                    displayMessage('無効な選択です。もう一度選んでください。');
                    createCharacter();  // 無効な選択の場合、キャラクター作成を再表示
                }
                break;

            case 'battle':
                if (['1', '2', '3', '4'].includes(command)) {
                    performAction(command);  // 行動を実行
                } else if (command === '5') {
                    displayMessage('現在のステータス:');
                    displayMessage(`HP: ${player.hp}/${classes[player.class].hp}`);
                    displayMessage(`MP: ${player.mp}/${classes[player.class].mp}`);
                    displayMessage(`攻撃力: ${player.attack}`);
                    displayMessage(`防御力: ${player.defense}`);
                    displayMessage(`素早さ: ${player.speed}`);
                    displayMessage(`レベル: ${player.level}`);
                    displayMessage(`経験値: ${player.exp}`);
                    displayBattleMenu();  // ステータス表示後、再度行動選択を表示
                } else {
                    displayMessage('無効な選択です。もう一度選んでください。');
                    displayBattleMenu();  // 無効な選択の場合、再度行動選択を表示
                }
                break;

            case 'skill-selection':  // スキル選択状態
                if (['1', '2', '3'].includes(command)) {
                    useSkill(parseInt(command) - 1);  // 選択したスキルを実行
                    gameState = 'battle';  // 戦闘状態に戻す
                } else {
                    displayMessage('無効なスキルです。もう一度選んでください。');
                    displaySkillMenu();  // 無効な選択の場合、再度スキルメニューを表示
                }
                break;

            case 'item-selection':  // アイテム選択状態（同様の処理が必要なら追加）
                // アイテム使用の処理をここに追加
                break;
        }
    }
});


        startGame();
    </script>
</body>
</html>